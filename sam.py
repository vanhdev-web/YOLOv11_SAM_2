from ultralytics import SAM
import cv2
import os

# Load a model
model = SAM("sam2.1_b.pt")

# Display model information (optional)
model.info()

# Run inference with bboxes prompt
root = "cars"
file_name = "frame0.jpg"

#frame0: [[42, 649], [463, 359], [1170, 540], [1427, 478], [1200, 407], [720, 314], [741, 261], [808, 248], [856, 248], [874, 235], [831, 235], [794, 202], [834, 197], [854, 211], [874, 188], [857, 165], [867, 155], [996, 276], [1046, 266], [1015, 240], [1043, 235], [1033, 221], [993, 228], [963, 221], [993, 211], [1013, 206], [1008, 183], [975, 195], [990, 182], [967, 178], [978, 158], [947, 172]]
#frame200:[[1868, 768], [1525, 672], [1152, 568], [1238, 477], [1351, 415], [1180, 412], [1068, 400], [562, 452], [1124, 332], [1053, 301], [1066, 268], [1043, 273], [990, 276], [1018, 255], [978, 256], [751, 321], [715, 278], [786, 256], [836, 251], [854, 240], [849, 208], [895, 235], [960, 225], [993, 225], [1006, 213], [960, 208], [998, 197], [993, 180], [900, 218], [872, 210], [887, 190], [871, 182], [887, 168], [902, 202], [980, 170]]
#frame100:[[1670, 795], [1241, 488], [1144, 369], [1147, 313], [1051, 351], [1063, 293], [1013, 309], [788, 387], [708, 347], [602, 341], [809, 334], [774, 289], [764, 240], [829, 260], [819, 235], [861, 228], [869, 215], [856, 195], [972, 248], [1006, 241], [993, 235], [1020, 231], [980, 220], [960, 213], [1005, 210], [1000, 195], [980, 172], [885, 168], [902, 202], [948, 177], [968, 183], [972, 195]]
#frame300: [[1863, 1000], [170, 760], [1200, 601], [1046, 380], [1165, 412], [1225, 384], [1147, 266], [1124, 349], [1073, 311], [1076, 291], [1001, 304], [542, 364], [738, 321], [783, 294], [811, 263], [811, 263], [874, 266], [993, 274], [1030, 260], [1013, 253], [1001, 246], [977, 243], [967, 233], [996, 235], [1035, 245], [882, 251], [894, 241], [822, 228], [836, 210], [857, 233], [899, 221], [856, 202], [879, 167], [980, 202], [990, 185], [987, 173], [973, 175]]
#frame400 : [[1895, 810], [295, 616], [579, 462], [799, 404], [1103, 440], [1232, 467], [1288, 415], [1149, 379], [1068, 376], [721, 341], [834, 327], [852, 296], [861, 284], [864, 268], [880, 258], [887, 241], [829, 258], [801, 248], [841, 228], [857, 240], [879, 215], [874, 175], [885, 173], [1013, 313], [1116, 301], [1053, 294], [990, 276], [1031, 274], [1094, 256], [1053, 258], [1005, 261], [973, 253], [1006, 240], [1015, 228], [991, 230], [987, 218], [965, 221], [958, 215], [973, 188], [985, 185], [982, 172]]
#frame500: [[319, 1030], [72, 845], [634, 601], [748, 414], [796, 342], [711, 313], [731, 261], [771, 235], [806, 245], [819, 269], [851, 314], [871, 279], [852, 245], [864, 182], [877, 172], [1116, 463], [1134, 382], [1205, 357], [1137, 304], [1033, 306], [1000, 294], [991, 271], [1053, 291], [1069, 268], [1056, 235], [1015, 260], [980, 258], [973, 243], [1005, 243], [1026, 231], [968, 228], [957, 226], [987, 215], [1000, 208], [978, 175], [978, 202], [955, 198], [910, 182]]
#frame600: [[1915, 656], [58, 641], [764, 427], [697, 359], [630, 303], [688, 274], [761, 276], [798, 294], [1035, 331], [1117, 339], [1076, 279], [1071, 263], [1011, 286], [1031, 273], [1015, 255], [1036, 248], [1031, 226], [978, 258], [977, 245], [993, 236], [967, 235], [991, 221], [975, 195], [967, 221], [889, 230], [869, 228], [907, 213], [879, 206], [861, 193], [887, 195], [912, 198], [872, 175], [882, 173], [914, 178], [977, 173], [991, 193], [1001, 210], [957, 206]]
#frame700: [[1664, 593], [448, 763], [198, 510], [489, 369], [682, 384], [1305, 361], [1028, 273], [1043, 248], [1015, 251], [1016, 235], [1001, 241], [996, 235], [980, 253], [975, 240], [967, 231], [1013, 211], [991, 215], [963, 210], [977, 200], [991, 193], [972, 182], [958, 198], [882, 258], [821, 261], [847, 255], [894, 240], [862, 235], [885, 223], [902, 221], [872, 216], [884, 202], [844, 203], [866, 187], [882, 168], [907, 203], [914, 177]]
# Run inference with multiple points
results = model(os.path.join(root, file_name),
                points=  [[42, 649], [463, 359], [1170, 540], [1427, 478], [1200, 407], [720, 314], [741, 261], [808, 248], [856, 248], [874, 235], [831, 235], [794, 202], [834, 197], [854, 211], [874, 188], [857, 165], [867, 155], [996, 276], [1046, 266], [1015, 240], [1043, 235], [1033, 221], [993, 228], [963, 221], [993, 211], [1013, 206], [1008, 183], [975, 195], [990, 182], [967, 178], [978, 158], [947, 172]]
)

points = results[0].boxes.xywhn


with open (file_name.replace("jpg","txt"),"w",encoding="utf-8") as f:
    for point in points:
        f.write("0 {} {} {} {}\n".format(*point))



image =results[0].plot(labels = False)
cv2.imshow("image", image)
cv2.waitKey(0)
